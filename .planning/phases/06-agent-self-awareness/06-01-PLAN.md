---
phase: 06-agent-self-awareness
plan: 01
type: execute
---

<objective>
Enable OpenClaw to know and prove its blockchain identity.

Purpose: Transform OpenClaw from anonymous text generator into agent that knows its public key, can prove identity to others via signatures, and has self-awareness of its capabilities.
Output: Identity tools module + agent context injection, allowing OpenClaw to answer "Who am I?" with blockchain proof.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/STACK.md
@src/wallet/agent-wallet.ts
@src/gateway/agidentity-openclaw-gateway.ts
@src/types/index.ts

**Tech stack available:**
- TypeScript 5.7, Node.js 22+
- @bsv/sdk for signatures
- @bsv/wallet-toolbox (BRC-100 wallet)
- AgentWallet already implements getPublicKey, createSignature

**Established patterns:**
- Tools in src/tools/ (currently empty placeholder)
- Each module has index.ts barrel export
- Types in src/types/index.ts
- Tests in src/__tests__/

**Constraining decisions:**
- Phase 5: Wallet exists, MPC-ready, used for device auth
- v1.0 Vision: Agent owns identity, can transact autonomously

**Architecture:**
AGIdentity Gateway wraps OpenClaw. Gateway has wallet. Goal: expose wallet identity to OpenClaw as "self-awareness" tools.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create identity tools module</name>
  <files>src/tools/identity-tools.ts, src/tools/index.ts</files>
  <action>
Create src/tools/identity-tools.ts with two functions:

1. `getIdentity(wallet: AgentWallet): Promise<AgentIdentity>` - Returns:
   - publicKey: agent's identity public key
   - capabilities: list of what agent can do ['sign', 'encrypt', 'transact']
   - network: 'mainnet' or 'testnet'

2. `proveIdentity(wallet: AgentWallet, data: string): Promise<IdentityProof>` - Returns:
   - signature: hex-encoded signature of data
   - publicKey: signer's public key
   - data: original data signed
   - timestamp: when signature created

Use wallet.getPublicKey({ identityKey: true }) and wallet.createSignature().
Signature should use protocolID [2, 'agent-identity-proof'].

Create src/tools/index.ts barrel export: export { getIdentity, proveIdentity } from './identity-tools.js';

Add types to src/types/index.ts:
```typescript
export interface AgentIdentity {
  publicKey: string;
  capabilities: string[];
  network: 'mainnet' | 'testnet';
}

export interface IdentityProof {
  signature: string;
  publicKey: string;
  data: string;
  timestamp: number;
}
```

AVOID: Do NOT create full tool registry system (that's Phase 8). Just the identity functions for now.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>identity-tools.ts exports getIdentity and proveIdentity, types defined, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Inject agent identity into OpenClaw context</name>
  <files>src/gateway/agidentity-openclaw-gateway.ts</files>
  <action>
In AGIdentityOpenClawGateway, modify message forwarding to inject agent identity context.

Find where messages are sent to OpenClaw (likely in handleMessage or similar).

Before sending message to OpenClaw, prepend context:
```
[AGENT IDENTITY]
You are an autonomous AI agent with blockchain identity.
Public Key: {agentPublicKey}
Network: {network}
Capabilities: sign messages, encrypt data, transact on BSV

You can prove your identity by signing data with your wallet key.
[END AGENT IDENTITY]

{original message content}
```

Use the agentPublicKey already available in gateway (this.agentPublicKey).
Get network from config or environment.

This makes OpenClaw aware of its identity in every conversation.

AVOID: Do NOT modify OpenClaw client code. Do NOT add tool calling yet (Phase 8). Just inject text context.
  </action>
  <verify>grep -r "AGENT IDENTITY" src/gateway/ confirms injection added</verify>
  <done>Every message to OpenClaw includes agent identity context prepended. Agent knows its public key and capabilities.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all existing tests
- [ ] identity-tools.ts exports getIdentity and proveIdentity
- [ ] Gateway prepends identity context to OpenClaw messages
- [ ] No new TypeScript errors introduced
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Identity tools module created and exported
- Agent identity injected into OpenClaw context
- OpenClaw now "knows" its public key and capabilities
- Phase 6 complete: Agent self-awareness established
</success_criteria>

<output>
After completion, create `.planning/phases/06-agent-self-awareness/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Agent Self-Awareness Summary

**Agent now knows its blockchain identity and can prove it cryptographically**

## Accomplishments

- Created identity tools module (getIdentity, proveIdentity)
- Defined AgentIdentity and IdentityProof types
- Injected agent identity context into all OpenClaw messages
- OpenClaw now aware of its public key, capabilities, network

## Files Created/Modified

- `src/tools/identity-tools.ts` - Identity awareness functions
- `src/tools/index.ts` - Barrel export
- `src/types/index.ts` - AgentIdentity, IdentityProof types
- `src/gateway/agidentity-openclaw-gateway.ts` - Context injection

## Decisions Made

- Identity context injected as text prefix (not tool calls - Phase 8)
- Signature uses protocolID [2, 'agent-identity-proof']
- Capabilities list: ['sign', 'encrypt', 'transact']

## Issues Encountered

None expected (straightforward integration).

## Next Phase Readiness

Phase 7 (Memory Write Path) ready to begin. Agent can now identify itself when writing memories to UHRP.

Phase 8 (Tool Registry) will make these identity functions callable by agent (not just context).
</output>
