# Phase 3.1: MPC Production Integration - Context

**Gathered:** 2026-02-15
**Status:** Ready for planning

<vision>
## How This Should Work

When the AI agent starts up, it should automatically connect to the MPC system and be ready to sign. No manual steps, no separate initialization commands.

The agent checks if a wallet already exists:
- **First run:** Runs DKG with the cosigners, creates the wallet, stores the share
- **Subsequent runs:** Restores the existing wallet from stored share

Cosigners are assumed to already be deployed and running somewhere (separate infrastructure). The agent just needs their endpoints in config - it doesn't manage or deploy them.

This should feel like starting any other service: configure endpoints and secrets via env vars, run the agent, it works.

</vision>

<essential>
## What Must Be Nailed

- **Just works** — Agent starts, MPC wallet ready, can sign immediately
- **Production-ready config** — Proper secrets management via env vars, no hardcoded anything
- **DKG + restore both work** — First run creates, subsequent runs restore, seamlessly

All three are equally important. The phase isn't done until all three work together.

</essential>

<boundaries>
## What's Out of Scope

- **Cosigner deployment** — Cosigners exist somewhere, we just connect to them
- **Key backup/recovery** — Not implementing backup flows in this phase
- **Multiple wallets** — One AI agent wallet only, not multi-tenant support
- **Cosigner management** — No spawning/monitoring cosigner processes from agent

</boundaries>

<specifics>
## Specific Ideas

- Single startup function: `createProductionMPCWallet(config)` that handles everything
- Config via environment variables:
  - `MPC_COSIGNER_ENDPOINTS` — comma-separated list of cosigner URLs
  - `MPC_SHARE_SECRET` — password for share encryption
  - `MPC_JWT_SECRET` — secret for cosigner auth
  - `MPC_WALLET_ID` — unique wallet identifier
  - `MPC_STORAGE_PATH` — where to store the wallet database
- Inject the real MPCWallet into the existing MPCAgentWallet wrapper

</specifics>

<notes>
## Additional Context

The MPC code lives in MPC-DEV/wallet-toolbox-mpc. It's not published to npm yet, so this phase needs to either:
1. Link to it locally during development
2. Copy the relevant modules into AGIdentity
3. Set up as a file dependency in package.json

The cosigners are from MPC-DEV/mpc-test-app/cosigner-servers - they're already tested and working on BSV testnet.

</notes>

---

*Phase: 3.1-mpc-production-integration*
*Context gathered: 2026-02-15*
